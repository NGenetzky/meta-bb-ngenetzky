image: crops/yocto:ubuntu-18.04-base

variables:
  DOCKER_DRIVER: overlay2
  DOCKER_TLS_CERTDIR: ""  # https://gitlab.com/gitlab-org/gitlab-runner/issues/4501

build:
  image: crops/yocto:ubuntu-18.04-base
  stage: build
  before_script:
    - ./scripts/setup.sh
  script:
    - ci/simple-r0.sh
    - ci/simple-r1.sh
    - ci/simple-r0-layerindex-fetch.sh
  artifacts:
    paths:
      - build/tmp/deploy/
  cache:
    key: "gitlab_build"
    paths:
      - "build/tmp/cache/"
      - "build/tmp/downloads/"
      - "build/tmp/sstate-cache/"
